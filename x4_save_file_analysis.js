
//   const sectorMetaData = [
//   ['Great Reef', -18, -7, "cluster_603", 'sector001'],
//   ['Barren Shores', -16, -8, "cluster_602", 'sector001'],
//   ['Watchful Gaze', -14, -9, "cluster_601", 'sector001'],
//   ['Ocean of Fantasy', -18, -3, "cluster_604", 'sector001'],
//   ['Sanctuary of Darkness', -20, -8, "cluster_605", 'sector001'],
//   ['Reflected Stars', -25, -9, "cluster_606", 'sector002'],
//   ['Kingdom End 1', -24, -10, "cluster_606", 'sector001'],
//   ['Towering Wave', -24, -9, "cluster_606", 'sector003'],
//   ['Rolk\'s Demise', -26, -9, "cluster_607", 'sector001'],
//   ['Menelaus\' Oasis', -26, -7, "cluster_609", 'sector001'],
//   ['Atreus\'s Clouds', -24, -8, "cluster_608", 'sector001'],
//   ['Mercury', -24, -4, "cluster_106", 'sector001'],
//   ['Venus', -24, -2, "cluster_102", 'sector001'],
//   ['Earth', -22, -3, "cluster_104", 'sector001'],
//   ['Moon', -22, -2, "cluster_104", 'sector002'],
//   ['Mars', -22, -1, "cluster_101", 'sector001'],
//   ['Asteroid Belt', -20, 0, "cluster_100", 'sector001'],
//   ['Adventure\'s Promise', -28, 0, "cluster_721", 'sector001'],
//   ['Jupiter', -22, 3, "cluster_107", 'sector001'],
//   ['Saturn 1', -24, 4, "cluster_108", 'sector001'],
//   ['Saturn 2', -25, 5, "cluster_108", 'sector003'],
//   ['Titan', -24, 5, "cluster_108", 'sector002'],
//   ['Uranus', -26, 5, "cluster_109", 'sector001'],
//   ['Neptune', -24, 6, "cluster_110", 'sector001'],
//   ['Pluto', -26, 7, "cluster_111", 'sector001'],
//   ['Oort Cloud', -28, 8, "cluster_116", 'sector001'],
//   ['Circle of Deceit', -20, 10, "cluster_724", 'sector001'],
//   ['Brennan\'s Triumph', -18, 7, "cluster_115", 'sector001'],
//   ['Gian Prophecy', -16, 8, "cluster_114", 'sector001'],
//   ['Segaris', -14, 7, "cluster_113", 'sector001'],
//   ['Sanctum Verge', -10, 9, "cluster_722", 'sector001'],
//   ['Mists of Artemis', -8, 8, "cluster_715", 'sector001'],
//   ['Atiya\'s Misfortune I', -8, 6, "cluster_26", 'sector001'],
//   ['Atiya\'s Misfortune III', -8, 7, "cluster_26", 'sector002'],
//   ['Wretched Skies V Family Phi', -10, -9, "cluster_403", 'sector001'],
//   ['Wretched Skies X', -12, -10, "cluster_422", 'sector001'],
//   ['Litany of Fury XII', -16, -10, "cluster_423", 'sector001'],
//   ['Litany of Fury IX', -16, -9, "cluster_423", 'sector001'],
//   ['Wretched Skies IV Family Valka', -8, -10, "cluster_400", 'sector001'],
//   ['Family Zhin', -4, -10, "cluster_401", 'sector001'],
//   ['Family Kritt', -4, -12, "cluster_402", 'sector001'],
//   ['Tharka\'s Cascade XV', -4, -7, "cluster_32", 'sector001'],
//   ['Tharka\'s Cascade XVII', -4, -8, "cluster_32", 'sector002'],
//   ['Matrix #79B', -6, -9, "cluster_33", 'sector001'],
//   ['Argon Prime', -6, -3, "cluster_14", 'sector001'],
//   ['Nopileos\' Fortune II', 4, 2, "cluster_04", 'sector001'],
//   ['Nopileos\' Fortune VI', 4, 3, "cluster_04", 'sector001'],
//   ['Grand Exchange I', 0, 1, "cluster_01", 'sector001'],
//   ['Grand Exchange III', -1, 1, "cluster_01", 'sector002'],
//   ['Grand Exchange IV', 0, 0, "cluster_01", 'sector003'],
//   ['Leap of Faith', 2, -1, "cluster_504", 'sector001'],
//   ['Eighteen Billion', 2, -3, "cluster_02", 'sector001'],
//   ['Silent Witness I', 0, -6, "cluster_08", 'sector001'],
//   ['Guiding Star VII', 10, -11, "cluster_416", 'sector002'],
//   ['Guiding Star V', 10, -10, "cluster_416", 'sector001'],
//   ['Eleventh Hour', 10, -15, "cluster_417", 'sector001'],
//   ['Matrix #451', 14, -5, "cluster_16", 'sector001'],
//   ['Frontier Edge', -10, 1, "cluster_49", 'sector001'],
//   ['Black Hole Sun IV', -2, 1, "cluster_06", 'sector001'],
//   ['Black Hole Sun V', -2, 2, "cluster_06", 'sector002'],
//   ['Savage Spur I', -10, -5, "cluster_112", 'sector001'],
//   ['Savage Spur II', -10, -4, "cluster_112", 'sector002'],
//   ['Getsu Fune', -12, -4, "cluster_48", 'sector001'],
//   ['Nopileos\' Memorial', -10, -3, "cluster_705", 'sector001'],
//   ['Hatikvah\'s Faith', -8, -2, "cluster_706", 'sector001'],
//   ['The Reach', -8, -4, "cluster_07", 'sector001'],
//   ['Heretic\'s End', -10, -7, "cluster_31", 'sector001'],
//   ['Antigone Memorial', -14, -1, "cluster_28", 'sector001'],
//   ['The Void', -12, -2, "cluster_27", 'sector001'],
//   ['Ore Belt', -12, 2, "cluster_720", 'sector001'],
//   ['Third Redemption', -12, 0, "cluster_730", 'sector001'],
//   ['Frontier Edge', -10, 1, "cluster_49", 'sector001'],
//   ['Silent Witness XII', 0, -8, "cluster_45", 'sector001'],
//   ['Silent Witness XI', 2, -7, "cluster_44", 'sector001'],
//   ['Rhy\'s Defiance', -4, -14, "cluster_414", 'sector001'],
//   ['Matrix #598', -4, -14, "cluster_415", 'sector001'],
//   ['Matrix #101', -2, -7, "cluster_708", 'sector001'],
//   ['Morning Star IV', -6, -7, "cluster_46", 'sector001'],
//   ['Morning Star III', -6, -5, "cluster_30", 'sector001'],
//   ['Hatikvah\'s Choice I', -4, -3, "cluster_29", 'sector001'],
//   ['Hatikvah\'s Choice III', -4, -4, "cluster_29", 'sector002'],
//   ['Windfall I Union Summit', 0, -4, "cluster_501", 'sector001'],
//   ['Windfall III The Hoard', -2, -3, "cluster_502", 'sector001'],
//   ['Windfall IV Aurora\'s Dream', -2, -1, "cluster_503", 'sector001'],
//   ['Avarice I', 0, -2, "cluster_500", 'sector001'],
//   ['Avarice V Dead End', 0, -1, "cluster_500", 'sector002'],
//   ['Avarice IV', -1, -1, "cluster_500", 'sector003'],
//   ['Second Contact II Flash Point', -4, 0, "cluster_13", 'sector001'],
//   ['Second Contact VII', -6, 1, "cluster_40", 'sector001'],
//   ['Second Contact XI', -6, -1, "cluster_41", 'sector001'],
//   ['Path to Profit', 0, 2, "cluster_05", 'sector001'],
//   ['True Sight', -4, 4, "cluster_12", 'sector001'],
//   ['Holy Vision', -2, 5, "cluster_24", 'sector001'],
//   ['Cardinal\'s Redress', -2, 7, "cluster_36", 'sector001'],
//   ['Pontifex\'s Claim', 0, 6, "cluster_11", 'sector001'],
//   ['Lasting Vengeance', 0, 8, "cluster_35", 'sector001'],
//   ['Freedom\'s Reach', -2, 9, "cluster_714", 'sector001'],
//   ['Tempting Fumes', 0, 12, "cluster_723", 'sector001'],
//   ['Cardinal\'s Domain', 6, 9, "cluster_709", 'sector001'],
//   ['Sacred Relic', 6, 7, "cluster_23", 'sector001'],
//   ['Pious Mists XI', 4, 6, "cluster_38", 'sector001'],
//   ['Pious Mists IV', 6, 5, "cluster_37", 'sector001'],
//   ['Pious Mists II', 4, 4, "cluster_22", 'sector001'],
//   ['Moo Kye\'s Revenge', 10, 7, "cluster_710", 'sector001'],
//   ['Mi Ton\'s Refuge', 10, 5, "cluster_711", 'sector001'],
//   ['Loomanckstrat\'s Legacy', 8, 4, "cluster_712", 'sector001'],
//   ['Scale Plate Green I', 12, 5, "cluster_21", 'sector001'],
//   ['Scale Plate Green VII', 12, 4, "cluster_21", 'sector002'],
//   ['Turquoise Sea IX', 14, 3, "cluster_50", 'sector001'],
//   ['Turquoise Sea X', 14, 4, "cluster_50", 'sector002'],
//   ['Company Regard', 12, 2, "cluster_20", 'sector001'],
//   ['Unholy Retribution', 8, 2, "cluster_10", 'sector001'],
//   ['CEO\'s Doubt', 6, 1, "cluster_713", 'sector001'],
//   ['Memory of Profit X', 4, 0, "cluster_39", 'sector001'],
//   ['Memory of Profit IX', 4, -2, "cluster_03", 'sector001'],
//   ['Trinity Sanctum VII', 6, -1, "cluster_47", 'sector001'],
//   ['Trinity Sanctum III', 8, 0, "cluster_18", 'sector001'],
//   ['Hewa\'s Twin I', 10, 2, "cluster_19", 'sector001'],
//   ['Hewa\'s Twin II', 10, 1, "cluster_19", 'sector002'],
//   ['Hewa\'s Twin III', 12, 0, "cluster_42", 'sector001'],
//   ['Hewa\'s Twin IV The Core', 12, 1, "cluster_42", 'sector002'],
//   ['Hewa\'s Twin V', 12, -1, "cluster_43", 'sector001'],
//   ['Fires of Defeat', 16, -8, "cluster_421", 'sector001'],
//   ['Family Tkr', 16, -6, "cluster_407", 'sector001'],
//   ['Tharka\'s Ravine XXIV', 18, -7, "cluster_409", 'sector001'],
//   ['Tharka\'s Ravine XVI', 20, -8, "cluster_410", 'sector001'],
//   ['Tharka\'s Ravine VIII', 22, -7, "cluster_412", 'sector001'],
//   ['Tharka\'s Ravine IV Tharka\'s Fall', 24, -8, "cluster_413", 'sector001'],
//   ['Thuruk\'s Demise II First Impact', 16, -4, "cluster_408", 'sector002'],
//   ['Thuruk\'s Demise III', 16, -3, "cluster_408", 'sector001'],
//   ['Ianamus Zura VII', 14, -3, "cluster_15", 'sector001'],
//   ['Ianamus Zura IV', 14, -2, "cluster_15", 'sector002'],
//   ['Heart Of Acrimony II', 20, -10, "cluster_411", 'sector001'],
//   ['Heart of Acrimony I The Boneyard', 18, -12, "cluster_425", 'sector001'],
//   ['Mitsuno\'s Revelation', 16, -2, "cluster_701", 'sector001'],
//   ['Mitsuno\'s Defiance', 18, -1, "cluster_702", 'sector001'],
//   ['Mitsuno\'s Sacrifice', 18, -3, "cluster_703", 'sector001'],
//   ['Matrix #9', 12, -6, "cluster_17", 'sector001'],
//   ['Bright Promis', 8, -4, "cluster_09", 'sector001'],
//   ['Profit Center Alpha', 6, -5, "cluster_34", 'sector001'],
//   ['Two Grand', 8, -8, "cluster_420", 'sector001'],
//   ['Open Market', 6, -9, "cluster_419", 'sector001'],
//   ['Family Nhuut', 4, -10, "cluster_418", 'sector001'],
//   ['Zyarth\'s Dominion I', 4, -12, "cluster_404", 'sector001'],
//   ['Zyarth\'s Dominion IV', 6, -11, "cluster_405", 'sector001'],
//   ['Zyarth\'s Dominion X', 6, -13, "cluster_406", 'sector001'],
//   ['Emperor\'s Pride IV', 18, -11, "cluster_424", 'sector001'],
//   ['Emperor\'s Pride VI', 18, -10, "cluster_424", 'sector002']
// ]
// sectorMetaData.sort((a, b) => a[3] - b[3])
// var map = sectorMetaData.map(s => [s[0], Math.floor(s[1]/2), Math.floor(s[2]/2), s[3], s[4]])
// console.log(JSON.stringify(map))


const sortedSectorData = 
[
 ["Great Reef",-9,-3,"cluster_603","sector001", 1],
 ["Barren Shores",-8,-3,"cluster_602","sector001", 1],
 ["Watchful Gaze",-7,-4,"cluster_601","sector001", 1],
 ["Ocean of Fantasy",-9,-2,"cluster_604","sector001", 1],
 ["Sanctuary of Darkness",-10,-4,"cluster_605","sector001", 1],
 ["Reflected Stars",-12,-5,"cluster_606","sector002", 5],
 ["Kingdom End 1",-12,-5,"cluster_606","sector001", 7],
 ["Towering Wave",-12,-5,"cluster_606","sector003", 3],
 ["Rolk's Demise",-13,-5,"cluster_607","sector001", 1],
 ["Menelaus' Oasis",-13,-4,"cluster_609","sector001", 1],
 ["Atreus's Clouds",-12,-4,"cluster_608","sector001", 1],
 ["Mercury",-12,-2,"cluster_106","sector001", 1],
 ["Venus",-12,-1,"cluster_102","sector001", 1],
 ["Earth",-11,-2,"cluster_104","sector001", 7],
 ["Moon",-11,-2,"cluster_104","sector002", 4],
 ["Mars",-11,-1,"cluster_101","sector001", 1],
 ["Asteroid Belt",-10,0,"cluster_100","sector001", 1],
 ["Adventure's Promise",-14,0,"cluster_721","sector001", 1],
 ["Jupiter",-11,1,"cluster_107","sector001", 1],
 ["Saturn 1",-12,2,"cluster_108","sector001", 3],
 ["Saturn 2",-12,2,"cluster_108","sector003", 7],
 ["Titan",-12,2,"cluster_108","sector002", 5],
 ["Uranus",-13,2,"cluster_109","sector001", 1],
 ["Neptune",-12,3,"cluster_110","sector001", 1],
 ["Pluto",-13,3,"cluster_111","sector001", 1],
 ["Oort Cloud",-14,4,"cluster_116","sector001", 1],
 ["Circle of Deceit",-10,5,"cluster_724","sector001", 1],
 ["Brennan's Triumph",-9,3,"cluster_115","sector001", 1],
 ["Gian Prophecy",-8,4,"cluster_114","sector001", 1],
 ["Segaris",-7,3,"cluster_113","sector001", 1],
 ["Sanctum Verge",-5,4,"cluster_722","sector001", 1],
 ["Mists of Artemis",-4,4,"cluster_715","sector001", 1],
 ["Atiya's Misfortune I",-4,3,"cluster_26","sector001", 7],
 ["Atiya's Misfortune III",-4,3,"cluster_26","sector002", 4],
 ["Wretched Skies V Family Phi",-5,-5,"cluster_403","sector001", 1],
 ["Wretched Skies X",-6,-5,"cluster_422","sector001", 1],
 ["Litany of Fury XII",-8,-5,"cluster_423","sector002", 2],
 ["Litany of Fury IX",-8,-5,"cluster_423","sector001", 5],
 ["Wretched Skies IV Family Valka",-4,-5,"cluster_400","sector001", 1],
 ["Family Zhin",-2,-5,"cluster_401","sector001", 1],
 ["Family Kritt",-2,-6,"cluster_402","sector001", 1],
 ["Tharka's Cascade XV",-2,-4,"cluster_32","sector001", 4],
 ["Tharka's Cascade XVII",-2,-4,"cluster_32","sector002", 7],
 ["Matrix #79B",-3,-5,"cluster_33","sector001", 1],
 ["Argon Prime",-3,-2,"cluster_14","sector001", 1],
 ["Nopileos' Fortune II",2,1,"cluster_04","sector001", 7],
 ["Nopileos' Fortune VI",2,1,"cluster_04","sector002", 4],
 ["Grand Exchange I",0,0,"cluster_01","sector001", 4],
 ["Grand Exchange III",0,0,"cluster_01","sector002", 6],
 ["Grand Exchange IV",0,0,"cluster_01","sector003", 2],
 ["Leap of Faith",1,-1,"cluster_504","sector001", 1],
 ["Eighteen Billion",1,-2,"cluster_02","sector001", 1],
 ["Silent Witness I",0,-3,"cluster_08","sector001", 1],
 ["President\'s End",1,-3,"cluster_704","sector001", 1],
 ["Guiding Star VII",5,-6,"cluster_416","sector002", 7],
 ["Guiding Star V",5,-6,"cluster_416","sector001", 4],
 ["Eleventh Hour",5,-8,"cluster_417","sector001", 1],
 ["Matrix #451",7,-3,"cluster_16","sector001", 1],
 ["Frontier Edge",-5,0,"cluster_49","sector001", 1],
 ["Black Hole Sun IV",-1,0,"cluster_06","sector001", 7],
 ["Black Hole Sun V",-1,0,"cluster_06","sector002", 4],
 ["Savage Spur I",-5,-3,"cluster_112","sector001", 2],
 ["Savage Spur II",-5,-3,"cluster_112","sector002", 5],
 ["Getsu Fune",-6,-2,"cluster_48","sector001", 1],
 ["Nopileos' Memorial",-5,-2,"cluster_705","sector001", 1],
 ["Hatikvah's Faith",-4,-1,"cluster_706","sector001", 1],
 ["The Reach",-4,-2,"cluster_07","sector001", 1],
 ["Heretic's End",-5,-4,"cluster_31","sector001", 1],
 ["Antigone Memorial",-7,-1,"cluster_28","sector001", 1],
 ["The Void",-6,-1,"cluster_27","sector001", 1],
 ["Ore Belt",-6,1,"cluster_720","sector001", 1],
 ["Third Redemption",-6,0,"cluster_730","sector001", 1],
 ["Frontier Edge",-5,0,"cluster_49","sector001", 1],
 ["Silent Witness XII",0,-4,"cluster_45","sector001", 1],
 ["Silent Witness XI",1,-4,"cluster_44","sector001", 1],
 ["Rhy's Defiance",-2,-7,"cluster_414","sector001", 1],
 ["Matrix #598",-2,-7,"cluster_415","sector001", 1],
 ["Matrix #101",-1,-4,"cluster_708","sector001", 1],
 ["Morning Star IV",-3,-4,"cluster_46","sector001", 1],
 ["Morning Star III",-3,-3,"cluster_30","sector001", 1],
 ["Hatikvah's Choice I",-2,-2,"cluster_29","sector001", 5],
 ["Hatikvah's Choice III",-2,-2,"cluster_29","sector002", 2],
 ["Windfall I Union Summit",0,-2,"cluster_501","sector001", 1],
 ["Windfall III The Hoard",-1,-2,"cluster_502","sector001", 1],
 ["Windfall IV Aurora's Dream",-1,-1,"cluster_503","sector001", 1],
 ["Avarice I",0,-1,"cluster_500","sector001", 2],
 ["Avarice V Dead End",0,-1,"cluster_500","sector002", 4],
 ["Avarice IV",0,-1,"cluster_500","sector003", 6],
 ["Second Contact II Flash Point",-2,0,"cluster_13","sector001", 1],
 ["Second Contact VII",-3,0,"cluster_40","sector001", 1],
 ["Second Contact XI",-3,-1,"cluster_41","sector001", 1],
 ["Path to Profit",0,1,"cluster_05","sector001", 1],
 ["True Sight",-2,2,"cluster_12","sector001", 1],
 ["Holy Vision",-1,2,"cluster_24","sector001", 1],
 ["Cardinal's Redress",-1,3,"cluster_36","sector001", 1],
 ["Pontifex's Claim",0,3,"cluster_11","sector001", 1],
 ["Lasting Vengeance",0,4,"cluster_35","sector001", 1],
 ["Freedom's Reach",-1,4,"cluster_714","sector001", 1],
 ["Tempting Fumes",0,6,"cluster_723","sector001", 1],
 ["Cardinal's Domain",3,4,"cluster_709","sector001", 1],
 ["Sacred Relic",3,3,"cluster_23","sector001", 1],
 ["Pious Mists XI",2,3,"cluster_38","sector001", 1],
 ["Pious Mists IV",3,2,"cluster_37","sector001", 1],
 ["Pious Mists II",2,2,"cluster_22","sector001", 1],
 ["Moo Kye's Revenge",5,3,"cluster_710","sector001", 1],
 ["Mi Ton's Refuge",5,2,"cluster_711","sector001", 1],
 ["Loomanckstrat's Legacy",4,2,"cluster_712","sector001", 1],
 ["Scale Plate Green I",6,2,"cluster_21","sector001", 4],
 ["Scale Plate Green VII",6,2,"cluster_21","sector002", 7],
 ["Turquoise Sea IX",7,1,"cluster_50","sector001", 7],
 ["Turquoise Sea X",7,1,"cluster_50","sector002", 4],
 ["Company Regard",6,1,"cluster_20","sector001", 1],
 ["Unholy Retribution",4,1,"cluster_10","sector001", 1],
 ["CEO's Doubt",3,0,"cluster_713","sector001", 1],
 ["Memory of Profit X",2,0,"cluster_39","sector001", 1],
 ["Memory of Profit IX",2,-1,"cluster_03","sector001", 1],
 ["Trinity Sanctum VII",3,-1,"cluster_47","sector001", 1],
 ["Trinity Sanctum III",4,0,"cluster_18","sector001", 1],
 ["Hewa's Twin I",5,0,"cluster_19","sector001", 5],
 ["Hewa's Twin II",5,0,"cluster_19","sector002", 2],
 ["Hewa's Twin III",6,0,"cluster_42","sector001", 7],
 ["Hewa's Twin IV The Core",6,0,"cluster_42","sector002", 4],
 ["Hewa's Twin V",6,-1,"cluster_43","sector001", 1],
 ["Fires of Defeat",8,-4,"cluster_421","sector001", 1],
 ["Family Tkr",8,-3,"cluster_407","sector001", 1],
 ["Tharka's Ravine XXIV",9,-4,"cluster_409","sector001", 1],
 ["Tharka's Ravine XVI",10,-4,"cluster_410","sector001", 1],
 ["Tharka's Ravine VIII",11,-4,"cluster_412","sector001", 1],
 ["Tharka's Ravine IV Tharka's Fall",12,-4,"cluster_413","sector001", 1],
 ["Thuruk's Demise III",8,-2,"cluster_408","sector001", 4],
 ["Thuruk's Demise II First Impact",8,-2,"cluster_408","sector002", 7],
 ["Ianamus Zura VII",7,-2,"cluster_15","sector001", 2],
 ["Ianamus Zura IV",7,-2,"cluster_15","sector002", 5],
 ["Heart Of Acrimony II",10,-5,"cluster_411","sector001", 1],
 ["Heart of Acrimony I The Boneyard",9,-6,"cluster_425","sector001", 1],
 ["Mitsuno's Revelation",8,-1,"cluster_701","sector001", 1],
 ["Mitsuno's Defiance",9,-1,"cluster_702","sector001", 1],
 ["Mitsuno's Sacrifice",9,-2,"cluster_703","sector001", 1],
 ["Matrix #9",6,-3,"cluster_17","sector001", 1],
 ["Bright Promis",4,-2,"cluster_09","sector001", 1],
 ["Profit Center Alpha",3,-3,"cluster_34","sector001", 1],
 ["Two Grand",4,-4,"cluster_420","sector001", 1],
 ["Open Market",3,-5,"cluster_419","sector001", 1],
 ["Family Nhuut",2,-5,"cluster_418","sector001", 1],
 ["Zyarth's Dominion I",2,-6,"cluster_404","sector001", 1],
 ["Zyarth's Dominion IV",3,-6,"cluster_405","sector001", 1],
 ["Zyarth's Dominion X",3,-7,"cluster_406","sector001", 1],
 ["Emperor's Pride IV",-9,-6,"cluster_424","sector001", 2],
 ["Emperor's Pride VI",-9,-6,"cluster_424","sector002", 5],
]

const factions = [
  ["khaak", "#c90000"],
  ["court", "#5b5b5b"],
  ["civilian", "#5b5b5b"],
  ["criminal", "#c90000"],
  ["argon", "#0079a5"],
  ["visitor", "#5b5b5b"],
  ["scavenger", "#005986"],
  ["antigone", "#00A6ff"],
  ["fallensplit", "#c530c5"],
  ["pioneers", "#00c1d5"],
  ["freesplit", "#d58100"],
  ["holyorderfanatic", "#ffbaff"],
  ["player", "rgb(17, 240, 51)"],
  ["smuggler", "#c90000"],
  ["split", "#d58100"],
  ["alliance", "#c530c5"],
  ["holyorder", "#ffbaff"],
  ["scaleplate", "#c90000"],
  ["xenon", "#c90000"],
  ["ministry", "#c5c500"],
  ["loanshark", "#b5a750"],
  ["boron", "#4cc6ff"],
  ["trinity", "#c530c5"],
  ["ownerless", "#5b5b5b"],
  ["paranid", "#c530c5"],
  ["yaki", "#c90000"],
  ["buccaneers", "#c90000"],
  ["terran", "#aad8ff"],
  ["teladi", "#c5c500"],
  ["hatikvah", "#50fFff"],
]

const factionsIndex = {}
factions.forEach(f => factionsIndex[f[0]] = f)

const sectorMacroIndex = {}
sortedSectorData.forEach(s => sectorMacroIndex[`${s[3]}_${s[4]}`] = s)

clusterMetaData = {}
sortedSectorData.forEach(s => clusterMetaData[s[3]] = [s[2], s[1]])



function buildSectorData(document) {
    let sectors = [];

    try {
      let sectoriterator = document.evaluate("/savegame/universe/component[@class='galaxy']/connections//component[@class='sector']", document, null, XPathResult.UNORDERED_NODE_ITERATOR_TYPE, null)
      var thissectorNode = sectoriterator.iterateNext();
      while (thissectorNode) {
        let macro = thissectorNode.getAttributeNode("macro").value;
        let sector_key = macro.substring(0, macro.length - "_macro".length)

        if (!sectorMacroIndex[sector_key]) {
          thissectorNode = sectoriterator.iterateNext();
          continue;
        }

        if (sectorIncludeFilter.length > 0) {
          if (!sectorIncludeFilter.includes(sector_key)) {
            thissectorNode = sectoriterator.iterateNext();
            continue;
          }
        }

        let factionKey = thissectorNode.getAttributeNode("owner").value
        let faction = factionsIndex[factionKey]

        let sector = { 
          sectorid: thissectorNode.getAttributeNode("id").value,
          macro: macro, 
          code: thissectorNode.getAttributeNode("code").value,
          owner: { color: faction ? faction[1] : "#5b5b5b", key: factionKey },
          node: thissectorNode,
        }
        sector.name = sectorMacroIndex[sector_key][0];
        sector.plot = [
          sectorMacroIndex[sector_key][1], 
          sectorMacroIndex[sector_key][2], 
          sectorMacroIndex[sector_key][5]
        ];

        sector.displayName = "sector "+sector.name+"(" + thissectorNode.getAttributeNode("code").value + ")", 
        // console.log("found sector: "+sector.displayName+" owner: " + sector.owner.key + " " + sector.owner.color + "]")
        sector.components = []
        appendSectorComponentData(document, sector.macro, "station", `rgb(21,0,255)`, sector.components)
        appendSectorComponentData(document, sector.macro, "datavault", `rgb(21,255,0)`, sector.components)
        sector.gates = []
        appendSectorGateData(document, sector.macro, sector.gates)
        sectors.push(sector);
        thissectorNode = sectoriterator.iterateNext();

      }
    }
    catch (e) {
      console.log(e)
      dump( 'Error: Document tree modified during iteration ' + e );
    }
    return sectors;
  }

  function appendSectorComponentData(document, sectorMacro, classType, color, components) {  
    let iterator = document.evaluate("/savegame/universe/component[@class='galaxy']/connections//component[@macro='"+sectorMacro+"']//component[@class='"+classType+"']", document, null, XPathResult.UNORDERED_NODE_ITERATOR_TYPE, null)
    var thisNode = iterator.iterateNext();
    while (thisNode) {
      let offsetNode = thisNode.getElementsByTagName("offset")[0]
      let posNode = offsetNode.getElementsByTagName("position")[0]

      let component = { 
        componentid: thisNode.getAttributeNode("id").value,
        macro: thisNode.getAttributeNode("macro").value, 
        code: thisNode.getAttributeNode("code").value,
        owner: thisNode.getAttributeNode("owner").value,
        node: thisNode, 
        displayName: classType + " (" + thisNode.getAttributeNode("code").value + ")",
        x: (posNode && parseInt(posNode.getAttribute('x') || "0"))/10, 
        y: (posNode && parseInt(posNode.getAttribute('y') || "0"))/10, 
        z: (posNode && parseInt(posNode.getAttribute('z') || "0"))/10,
        r: 2,
        color: color
      }

      components.push(component)
      //console.log(classType + " found: code = " + component.code + " name = " + component.displayName)

      thisNode = iterator.iterateNext();
    }
  }

  const clusterConnectionType = "clustergate"
  const destinationConnectionType = "destination"
  const highwayentryConnectionType = "highwayentry"
  const highwayexitConnectionType = "highwayexit"
  function appendSectorGateData(document, sectorMacro, gates) {  
    let iterator = document.evaluate("/savegame/universe/component[@class='galaxy']/connections//component[@macro='"+sectorMacro+"']//component[@class='gate']", document, null, XPathResult.UNORDERED_NODE_ITERATOR_TYPE, null)
    var thisNode = iterator.iterateNext();
    while (thisNode) {
      let connectionsNode = thisNode.getElementsByTagName("connections")[0]
      let connections = [];

      if (connectionsNode) {
        let connectionNodes = connectionsNode.getElementsByTagName("connection")
        if (!connectionNodes) {
          thisNode = iterator.iterateNext();
          continue;
        }
        if (connectionNodes.length == 0) {
          thisNode = iterator.iterateNext();
          continue;
        }

        for(i = 0; i < connectionNodes.length; i++) {

          element = connectionNodes[i];
          let connectedNodes = element.getElementsByTagName("connected")
          if (connectedNodes.length == 0) {
              return;
          }
          let connectionType = element.getAttributeNode("connection").value
          if (!connectionType) {
              return;
          }

          connectionType = connectionType.startsWith(clusterConnectionType) ? clusterConnectionType
          : connectionType.startsWith(destinationConnectionType) ? destinationConnectionType 
          : connectionType.startsWith(highwayentryConnectionType) ? highwayentryConnectionType
          : connectionType.startsWith(highwayexitConnectionType) ? highwayexitConnectionType : connectionType;

          let connection = {
              id: element.getAttributeNode("id").value,
              type: connectionType,
              connectedTo: connectedNodes[0].getAttributeNode("connection").value
          }
          connections.push(connection) 
          //console.log("connection found: id = " + connection.id + " type = " + connection.type)
        };
      }

      let gate = { 
        componentid: thisNode.getAttributeNode("id").value,
        macro: thisNode.getAttributeNode("macro").value, 
        code: thisNode.getAttributeNode("code").value,
        node: thisNode, 
        displayName: "gate (" + thisNode.getAttributeNode("code").value + ")",
        x: 0, 
        y: 0, 
        z: 0,
        r: 2,
        color: "rgb(255,21,0)",
        connections: connections
      }

      gates.push(gate)
      //console.log("gate found: code = " + gate.code + " name = " + gate.displayName)

      thisNode = iterator.iterateNext();
    }
  }

  function buildSectorConnections(sectors) {
    var clusterconnections = []
    sectors.forEach(sector => {
        sector.gates.forEach(gate => {
            gate.connections.forEach(connection => {
                if (connection.type == clusterConnectionType){
                    clusterConnection = { 
                        type: connection.type, 
                        from: { sector: sector, id: connection.id }, 
                        to: { id: connection.connectedTo, sector: sector },
                        displayText: sector.name + " to "
                    }
                    clusterconnections.push(clusterConnection)
                    //console.log("cluster connection found: displayText = " + clusterConnection.displayText + " type = " + clusterConnection.type)
                }
            })
        })
    })

    clusterconnections.forEach(connection => {
        sectors.forEach(sector => {
            sector.gates.forEach(gate => {
                gate.connections.forEach(gateconnection => {
                    if (connection.to.id == gateconnection.id){
                        connection.to.sector = sector
                        connection.displayText = connection.displayText + sector.name
                        //console.log("cluster destination found: displayText = " + connection.displayText + " type = " + connection.type)
                    }
                })
            })
        })
    })

    return clusterconnections;
  }